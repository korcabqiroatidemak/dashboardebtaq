<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Dashboard EBTAQ</title>
    <style>
        /* DEFINISI VARIABEL CSS DASAR */
        :root {
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-main: #2c3e50;
            --accent: #e74c3c;
            /* Default Theme (Emerald) */
            --grad-start: #047857;
            --grad-end: #10b981;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 0;
            color: var(--text-main);
            transition: all 0.4s ease;
        }

        /* NAVBAR DENGAN GRADASI DINAMIS */
        .navbar {
            background: linear-gradient(135deg, var(--grad-start), var(--grad-end));
            padding: 15px 40px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            position: sticky; top: 0; z-index: 100;
        }

        /* BRANDING (LOGO & JUDUL BESAR) */
        .brand {
            display: flex; align-items: center;
            padding: 8px 15px; border-radius: 12px;
            transition: 0.3s; position: relative;
        }
        .brand img {
            height: 65px; /* Ukuran Logo Konsisten */
            width: auto;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2));
        }
        .brand span {
            font-size: 32px; /* Ukuran Judul Setara Logo */
            font-weight: 800; margin-left: 18px;
            letter-spacing: 1.5px; text-transform: uppercase;
            color: #ffffff; text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* EDIT MODE INDICATOR PADA HEADER */
        body.edit-active .brand {
            cursor: pointer;
            outline: 3px dashed rgba(255,255,255,0.6);
            outline-offset: 4px;
            background: rgba(255,255,255,0.1);
        }
        .header-edit-icon {
            display: none; position: absolute; -right: 10px; -top: 5px;
            background: var(--accent); color: white;
            width: 28px; height: 28px; border-radius: 50%;
            text-align: center; line-height: 28px; font-size: 16px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        body.edit-active .header-edit-icon { display: block; }

        /* KONTROL NAVIGASI */
        .controls { display: flex; gap: 12px; align-items: center; }
        .controls button, .controls a.btn-link {
            padding: 10px 18px; border: none; border-radius: 8px;
            font-weight: 700; cursor: pointer; transition: 0.3s;
            font-size: 14px; text-decoration: none;
            display: inline-flex; align-items: center; gap: 8px; color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .controls button svg { width: 20px; height: 20px; fill: currentColor; }
        
        /* LOGIKA SEMBUNYIKAN TOMBOL ADMIN */
        .admin-only { display: none !important; }
        body.edit-active .admin-only { display: inline-flex !important; animation: slideDown 0.3s ease; }

        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* WARNA TOMBOL */
        .btn-edit-mode { background: #f39c12; }
        .btn-source { background: rgba(255,255,255,0.2); backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.4) !important; }
        .btn-backup { background: #3498db; }
        .btn-add { background: #27ae60; }

        /* CONTAINER KARTU */
        .container {
            max-width: 1300px; margin: 50px auto; padding: 0 30px;
            display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px;
        }

        .card {
            background: var(--card-bg); border-radius: 20px; padding: 25px;
            position: relative; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-decoration: none; color: var(--text-main);
            display: flex; flex-direction: column; height: 200px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            border-top: 5px solid var(--grad-start);
        }
        .card:hover { transform: translateY(-10px); box-shadow: 0 15px 30px rgba(0,0,0,0.12); }
        
        .card-icon { height: 60px; margin-bottom: 15px; display: flex; align-items: center; }
        .card-icon svg { width: 52px; height: 52px; fill: var(--grad-start); }
        .card-title { font-size: 20px; font-weight: 800; margin: 0 0 8px 0; color: var(--grad-start); }
        .card-desc { font-size: 14px; color: #64748b; line-height: 1.5; flex: 1; overflow: hidden; }
        
        /* EDIT CARD UI */
        .editor-controls { position: absolute; top: 15px; right: 15px; display: none; gap: 8px; }
        body.edit-active .editor-controls { display: flex; }
        body.edit-active .card { outline: 2px dashed #f39c12; background: #fffdf9; }
        .mini-btn { width: 30px; height: 30px; border-radius: 50%; border: none; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center; }
        .btn-del { background: #ef4444; } .btn-mod { background: #3b82f6; } .btn-move { background: #64748b; }

        /* THEME PICKER (DI DALAM MODAL) */
        .theme-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px; }
        .theme-opt { 
            height: 40px; border-radius: 8px; cursor: pointer; border: 3px solid transparent; 
            transition: 0.2s; background: linear-gradient(135deg, var(--s), var(--e));
        }
        .theme-opt:hover { transform: scale(1.05); }
        .theme-opt.active { border-color: #333; box-shadow: 0 0 10px rgba(0,0,0,0.2); }

        /* MODAL SYSTEM */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.8); z-index: 200; justify-content: center; align-items: center;
            backdrop-filter: blur(8px);
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 16px; width: 450px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 700; color: #1e293b; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 12px; margin-top: 25px; }

        @media (max-width: 900px) {
            .navbar { flex-direction: column; padding: 20px; text-align: center; }
            .brand span { font-size: 24px; }
            .controls { flex-wrap: wrap; justify-content: center; margin-top: 15px; }
        }
    </style>
</head>
<body>

    <div class="navbar">
        <div class="brand" id="brandHeader" onclick="openHeaderModal()">
            <img id="navLogo" src="QIRAATI.png" alt="Logo" onerror="this.src='https://via.placeholder.com/65?text=TPQ'">
            <span id="navTitle">DASHBOARD EBTAQ</span>
            <div class="header-edit-icon">âœŽ</div>
        </div>

        <div class="controls">
            <a href="https://github.com/korcabqiroatidemak/dashboardebtaq/blob/main/index.html" target="_blank" class="btn-link btn-source admin-only">
                <svg viewBox="0 0 24 24"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg> Kode
            </a>
            
            <button class="btn-backup admin-only" onclick="backupData()">
                <svg viewBox="0 0 24 24"><path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z"></path></svg> Backup
            </button>

            <button class="btn-backup admin-only" onclick="restoreData()">
                <svg viewBox="0 0 24 24"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10zm-7.79-3.11l-2.76 2.76L10 17l4-4-4-4-.55.55 2.76 2.76H6.11v.79h6.1z"></path></svg> Restore
            </button>

            <button class="btn-edit-mode" onclick="toggleEditMode()" id="btnMode">
                <svg viewBox="0 0 24 24"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"></path></svg> Edit: OFF
            </button>

            <button class="btn-add admin-only" onclick="openModal()">
                <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path></svg> Proyek
            </button>
        </div>
    </div>

    <div class="container" id="cardContainer"></div>

    <div class="modal" id="headerModal">
        <div class="modal-content">
            <h3 style="margin:0 0 20px 0; color:#1e293b; border-bottom:2px solid #f1f5f9; padding-bottom:10px;">Pengaturan Dashboard</h3>
            <div class="form-group"><label>Judul Dashboard</label><input type="text" id="cfgTitle"></div>
            <div class="form-group"><label>File Logo (e.g QIRAATI.png)</label><input type="text" id="cfgLogo"></div>
            <div class="form-group">
                <label>Pilih Tema Gradasi</label>
                <div class="theme-grid" id="themeGrid"></div>
            </div>
            <div class="modal-actions">
                <button onclick="closeModal('headerModal')" style="background:#64748b; color:white; border:none; padding:10px 20px; border-radius:8px;">Batal</button>
                <button onclick="saveHeaderConfig()" style="background:#3b82f6; color:white; border:none; padding:10px 20px; border-radius:8px; font-weight:bold;">Simpan</button>
            </div>
        </div>
    </div>

    <div class="modal" id="projectModal">
        <div class="modal-content">
            <h3 id="modalTitle" style="margin:0 0 20px 0;">Tambah Proyek</h3>
            <input type="hidden" id="editIndex"> 
            <div class="form-group"><label>Nama Proyek</label><input type="text" id="inpTitle"></div>
            <div class="form-group"><label>Deskripsi</label><textarea id="inpDesc" rows="2"></textarea></div>
            <div class="form-group"><label>Ikon (Emoji / SVG)</label><input type="text" id="inpIcon" value="ðŸ“‚"></div>
            <div class="form-group"><label>Link File HTML</label><input type="text" id="inpLink"></div>
            <div class="form-group"><label>Link Edit (Opsional)</label><input type="text" id="inpEditLink"></div>
            <div class="modal-actions">
                <button onclick="closeModal('projectModal')" style="background:#64748b; color:white; border:none; padding:10px 20px; border-radius:8px;">Batal</button>
                <button onclick="saveProject()" style="background:#10b981; color:white; border:none; padding:10px 20px; border-radius:8px; font-weight:bold;">Simpan</button>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" style="display: none;" onchange="handleFileSelect(this)">

<script>
    // --- 1. DATA & CONFIG ---
    let projects = JSON.parse(localStorage.getItem('myProjectsDB')) || [];
    let config = JSON.parse(localStorage.getItem('dashboardConfig')) || {
        title: "DASHBOARD EBTAQ",
        logo: "QIRAATI.png",
        themeIdx: 0
    };

    // 7 PRESET GRADASI
    const themes = [
        { s: "#047857", e: "#10b981" }, // Emerald
        { s: "#1e3a8a", e: "#3b82f6" }, // Midnight Blue
        { s: "#9a3412", e: "#f97316" }, // Terracotta
        { s: "#581c87", e: "#a855f7" }, // Royal Purple
        { s: "#0f766e", e: "#14b8a6" }, // Ocean Teal
        { s: "#be123c", e: "#fb7185" }, // Rose Red
        { s: "#334155", e: "#94a3b8" }  // Slate Slate
    ];

    let isEditMode = false;
    let tempThemeIdx = config.themeIdx;

    // --- 2. RENDERERS ---
    function render() {
        applyTheme(config.themeIdx);
        document.getElementById('navTitle').innerText = config.title;
        document.getElementById('navLogo').src = config.logo;
        
        const container = document.getElementById('cardContainer');
        container.innerHTML = projects.length ? '' : `<div class="empty-state"><h3>Dashboard Siap. Klik Edit Mode untuk mengelola.</h3></div>`;
        
        projects.forEach((p, i) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="editor-controls">
                    <button class="mini-btn btn-move" onclick="moveProject(${i},-1)">â–²</button>
                    <button class="mini-btn btn-move" onclick="moveProject(${i},1)">â–¼</button>
                    <button class="mini-btn btn-mod" onclick="editProject(${i})">âœŽ</button>
                    <button class="mini-btn btn-del" onclick="deleteProject(${i})">âœ–</button>
                </div>
                <div class="card-icon">${p.icon}</div>
                <div class="card-title">${p.title}</div>
                <div class="card-desc">${p.desc}</div>
                <a href="${p.link}" target="_blank" class="card-link-overlay"></a>
            `;
            container.appendChild(card);
        });
    }

    function applyTheme(idx) {
        const t = themes[idx];
        document.documentElement.style.setProperty('--grad-start', t.s);
        document.documentElement.style.setProperty('--grad-end', t.e);
    }

    // --- 3. LOGIKA ADMIN & HEADER ---
    function toggleEditMode() {
        isEditMode = !isEditMode;
        document.body.classList.toggle('edit-active', isEditMode);
        document.getElementById('btnMode').innerHTML = isEditMode ? 
            `<svg viewBox="0 0 24 24"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"></path></svg> Edit: ON` :
            `<svg viewBox="0 0 24 24"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"></path></svg> Edit: OFF`;
    }

    function openHeaderModal() {
        if(!isEditMode) return;
        document.getElementById('cfgTitle').value = config.title;
        document.getElementById('cfgLogo').value = config.logo;
        tempThemeIdx = config.themeIdx;
        renderThemeOptions();
        document.getElementById('headerModal').style.display = 'flex';
    }

    function renderThemeOptions() {
        const grid = document.getElementById('themeGrid');
        grid.innerHTML = '';
        themes.forEach((t, i) => {
            const opt = document.createElement('div');
            opt.className = `theme-opt ${i === tempThemeIdx ? 'active' : ''}`;
            opt.style.setProperty('--s', t.s);
            opt.style.setProperty('--e', t.e);
            opt.onclick = () => {
                tempThemeIdx = i;
                applyTheme(i); // Live Preview
                renderThemeOptions();
            };
            grid.appendChild(opt);
        });
    }

    function saveHeaderConfig() {
        config.title = document.getElementById('cfgTitle').value || config.title;
        config.logo = document.getElementById('cfgLogo').value || config.logo;
        config.themeIdx = tempThemeIdx;
        localStorage.setItem('dashboardConfig', JSON.stringify(config));
        render();
        closeModal('headerModal');
    }

    // --- 4. CRUD PROYEK ---
    function openModal() {
        document.getElementById('editIndex').value = '-1';
        ['inpTitle','inpDesc','inpLink','inpEditLink'].forEach(id => document.getElementById(id).value = '');
        document.getElementById('projectModal').style.display = 'flex';
    }

    function closeModal(id) { 
        document.getElementById(id).style.display = 'none'; 
        if(id === 'headerModal') applyTheme(config.themeIdx); // Revert preview jika batal
    }

    function saveProject() {
        const data = {
            title: document.getElementById('inpTitle').value,
            desc: document.getElementById('inpDesc').value,
            icon: document.getElementById('inpIcon').value,
            link: document.getElementById('inpLink').value,
            editLink: document.getElementById('inpEditLink').value
        };
        const idx = parseInt(document.getElementById('editIndex').value);
        if(!data.title || !data.link) return alert("Data belum lengkap!");
        
        if(idx === -1) projects.push(data);
        else projects[idx] = data;

        localStorage.setItem('myProjectsDB', JSON.stringify(projects));
        render(); closeModal('projectModal');
    }

    function deleteProject(i) { if(confirm("Hapus?")) { projects.splice(i,1); localStorage.setItem('myProjectsDB', JSON.stringify(projects)); render(); } }
    
    function editProject(i) {
        const p = projects[i];
        document.getElementById('editIndex').value = i;
        document.getElementById('inpTitle').value = p.title;
        document.getElementById('inpDesc').value = p.desc;
        document.getElementById('inpIcon').value = p.icon;
        document.getElementById('inpLink').value = p.link;
        document.getElementById('inpEditLink').value = p.editLink;
        document.getElementById('projectModal').style.display = 'flex';
    }

    function moveProject(i, d) {
        const ni = i + d;
        if(ni >= 0 && ni < projects.length) {
            [projects[i], projects[ni]] = [projects[ni], projects[i]];
            localStorage.setItem('myProjectsDB', JSON.stringify(projects)); render();
        }
    }

    // --- 5. BACKUP & RESTORE ---
    function backupData() {
        const bundle = { projects, config };
        const blob = new Blob([JSON.stringify(bundle)], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `backup_ebtaq_${new Date().toLocaleDateString()}.json`;
        a.click();
    }

    function restoreData() { document.getElementById('fileInput').click(); }

    function handleFileSelect(input) {
        const reader = new FileReader();
        reader.onload = e => {
            const data = JSON.parse(e.target.result);
            if(data.projects && data.config) {
                projects = data.projects; config = data.config;
                localStorage.setItem('myProjectsDB', JSON.stringify(projects));
                localStorage.setItem('dashboardConfig', JSON.stringify(config));
                render(); alert("Restorasi Berhasil!");
            }
        };
        reader.readAsText(input.files[0]);
    }

    render();
</script>
</body>
</html>
